# Hints â€” Softmax

## Naive: reduction for max (shared memory)
```cuda
for (int s = blockDim.x / 2; s > 0; s >>= 1) {
    if (tid < s) sdata[tid] = fmaxf(sdata[tid], sdata[tid + s]);
    __syncthreads();
}
```

## Online update rule
```cuda
float m_new = fmaxf(local_m, x);
local_d = local_d * expf(local_m - m_new) + expf(x - m_new);
local_m = m_new;
```

## Merging two (m, d) pairs
```cuda
float m_new = fmaxf(m1, m2);
float d_new = d1 * expf(m1 - m_new) + d2 * expf(m2 - m_new);
```

## Causal mask in online scan
```cuda
for (int i = tid; i < cols; i += blockDim.x) {
    if (i > query_pos) continue;  // skip masked positions
    float x = x_row[i];
    // online update...
}
```
